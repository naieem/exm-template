{"version":3,"sources":["blocks/googlemap.js"],"names":["$","initializeBlock","$block","map","addressData","find","data","MY_MAPTYPE_ID","lat","lng","markerPos","google","maps","LatLng","featureOpts","featureType","elementType","stylers","color","mapData","themeColors","visibility","saturation","lightness","mapOptions","zoom","scrollwheel","zoomControl","disableDefaultUI","center","labelContent","siteName","mapTypeControlOptions","mapTypeIds","MapTypeId","ROADMAP","mapTypeId","Map","customMapType","StyledMapType","name","mapTypes","set","infowindow","InfoWindow","content","encodeURIComponent","address","itineraire","markerMap","Marker","position","title","addListener","open","document","ready","each","this","window","acf","addAction","marker","field","mapReady","doAction","on","e","ACFmap","getField","findFields","sibling","$el","$input","prop","hide","searchPositionCopy","searchPosition","setDraggable","jQuery","post","wp","ajax","settings","url","action","res","JSON","stringify","val","show","mapField","cid","trigger"],"mappings":"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","file":"../../blocks/googlemap.min.js","sourcesContent":["(function($){\n\n    /**\n     * initializeBlock\n     *\n     * Adds custom JavaScript to the block HTML.\n     *\n     * @date    15/4/19\n     * @since   1.0.0\n     *\n     * @param   object $block The block jQuery element.\n     * @param   object attributes The block attributes (only available when editing).\n     * @return  void\n     */\n    var initializeBlock = function( $block ) {\n        var addressData = $block.find('.map').data('address');\n\t\tvar map;\n\t\tvar MY_MAPTYPE_ID = 'custom_style';\n        var lat = addressData.lat;\n        var lng = addressData.lng;\n        \n        var markerPos = new google.maps.LatLng(lat, lng);\n                \n        var featureOpts = [\n                {\n                \"featureType\": \"administrative\",\n                \"elementType\": \"labels.text.fill\",\n                \"stylers\": [\n                    {\n                        \"color\": mapData.themeColors[4].color\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"landscape\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"color\": mapData.themeColors[2].color\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"poi\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"visibility\": \"off\"\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"road\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"saturation\": -100\n                    },\n                    {\n                        \"lightness\": 45\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"road.highway\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"visibility\": \"simplified\"\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"road.arterial\",\n                \"elementType\": \"labels.icon\",\n                \"stylers\": [\n                    {\n                        \"visibility\": \"off\"\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"transit\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"visibility\": \"off\"\n                    }\n                ]\n            },\n            {\n                \"featureType\": \"water\",\n                \"elementType\": \"all\",\n                \"stylers\": [\n                    {\n                        \"color\": mapData.themeColors[1].color\n                    },\n                    {\n                        \"visibility\": \"on\"\n                    }\n                ]\n            }\n        ];\n                \n        var mapOptions = {\n            zoom: 13,\n            scrollwheel : false,\n            zoomControl: true,\n            disableDefaultUI: true,\n            center: markerPos,\n            labelContent: mapData.siteName,\n            mapTypeControlOptions: {\n                mapTypeIds: [google.maps.MapTypeId.ROADMAP, MY_MAPTYPE_ID]\n            },\n            mapTypeId: MY_MAPTYPE_ID\n        };// mappOptions\n                \n        map = new google.maps.Map($block.find('.map')[0], mapOptions);\n        \n        var styledMapOptions = {\n            name: 'Custom Style'\n        };//StyledMapOptions\n                \n        var customMapType = new google.maps.StyledMapType(featureOpts, styledMapOptions);\n        \n        map.mapTypes.set(MY_MAPTYPE_ID, customMapType);\n        \n        var infowindow = new google.maps.InfoWindow({\n            content: '<a href=\"https://www.google.ca/maps/dir//'+encodeURIComponent(addressData.address)+'\" target=\"_blank\" rel=\"nooponer\">'+mapData.itineraire+'</a>'\n        });\n                \n        var markerMap = new google.maps.Marker({\n            position: markerPos,\n            map: map,\n            title: mapData.siteName\n        });// A marker\n                \n        markerMap.addListener('click', function() {\n            infowindow.open(map, markerMap);\n        });\n    }\n\n    // Initialize each block on page load (front end).\n    $(document).ready(function(){\n        $('.google-map').each(function(){\n            initializeBlock( $(this) );\n        });\n    });\n\n    // Initialize dynamic block preview (editor).\n    if( window.acf ) {\n        window.acf.addAction( 'render_block_preview/type=googlemap', initializeBlock );\n\n        window.acf.addAction('google_map_init', function( map, marker, field ){ // Signale lorsque le champ google map est prêt à être modifié.\n            field.mapReady = true;\n            window.acf.doAction('field_map_ready', field, map);\n        });\n\n        window.acf.addAction('new_field/name=utiliser_ladresse_generale', function(field){\n            field.on('change', 'input', function( e ){ // Quand on change le true/false.\n                let ACFmap = window.acf.getField(window.acf.findFields({name: 'map', sibling: field.$el})); // Le champ map associé au true/false.\n                \n                if(ACFmap.mapReady){ // Si le champ de la map est prêt à être manipulé.\n                    if(field.$input().prop('checked')){\n                        ACFmap.$el.find('input.search').hide(); // on cache la barre de recherche.\n                        ACFmap.searchPositionCopy = ACFmap.searchPosition; // Garde en copy la function pour positionner le marker au clic.\n                        ACFmap.searchPosition = function(){return false;}; // On désactive la fonction de click pour positionner le marker.\n                        ACFmap.map.marker.setDraggable(false); // désactive le drag and drop du marker.\n\n                        // On va chercher l'adresse générale et on change la valeur de la carte.\n                        jQuery.post(window.wp.ajax.settings.url, {action: 'theme_client_get_option_address'}, function(res){\n                            JSON.stringify(res);\n            \n                            ACFmap.val(res);\n                        }, 'json');\n\n                    }else{ // On réactive les options de positionnement du marker.\n                        ACFmap.$el.find('input.search').show();\n                        ACFmap.searchPosition = ACFmap.searchPositionCopy;\n                        ACFmap.map.marker.setDraggable(true);\n                    }\n\n                }else{ // Si la map est pas prête, on attent l'action.\n                    window.acf.addAction('field_map_ready', function(mapField, map){\n                        if(mapField.cid == ACFmap.cid){\n                            field.$input().trigger('change');\n                        }\n                    });\n                }\n            });\n\n            field.$input().trigger('change');\n        });\n    }\n\n})(jQuery);"]}