{"version":3,"sources":["blocks/googlemap.js"],"names":["$","initializeBlock","$block","map","addressData","find","data","lat","lng","markerPos","google","maps","LatLng","featureOpts","featureType","elementType","stylers","color","mapData","themeColors","visibility","saturation","lightness","mapOptions","zoom","scrollwheel","zoomControl","disableDefaultUI","center","labelContent","siteName","mapTypeControlOptions","mapTypeIds","MapTypeId","ROADMAP","mapTypeId","Map","customMapType","StyledMapType","name","mapTypes","set","infowindow","InfoWindow","content","encodeURIComponent","address","itineraire","markerMap","Marker","position","title","addListener","open","document","ready","each","this","window","acf","addAction","marker","field","mapReady","doAction","on","e","ACFmap","getField","findFields","sibling","$el","$input","prop","hide","searchPositionCopy","searchPosition","setDraggable","jQuery","post","wp","ajax","settings","url","action","res","JSON","stringify","val","show","mapField","cid","trigger"],"mappings":"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","file":"../../blocks/googlemap.min.js","sourcesContent":["(function($){\r\n\r\n    /**\r\n     * initializeBlock\r\n     *\r\n     * Adds custom JavaScript to the block HTML.\r\n     *\r\n     * @date    15/4/19\r\n     * @since   1.0.0\r\n     *\r\n     * @param   object $block The block jQuery element.\r\n     * @param   object attributes The block attributes (only available when editing).\r\n     * @return  void\r\n     */\r\n    var initializeBlock = function( $block ) {\r\n        var addressData = $block.find('.map').data('address');\r\n\t\tvar map;\r\n\t\tvar MY_MAPTYPE_ID = 'custom_style';\r\n        var lat = addressData.lat;\r\n        var lng = addressData.lng;\r\n        \r\n        var markerPos = new google.maps.LatLng(lat, lng);\r\n                \r\n        var featureOpts = [\r\n                {\r\n                \"featureType\": \"administrative\",\r\n                \"elementType\": \"labels.text.fill\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": mapData.themeColors[4].color\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"landscape\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": mapData.themeColors[2].color\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"poi\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"saturation\": -100\r\n                    },\r\n                    {\r\n                        \"lightness\": 45\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.highway\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"simplified\"\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.arterial\",\r\n                \"elementType\": \"labels.icon\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"transit\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"water\",\r\n                \"elementType\": \"all\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": mapData.themeColors[1].color\r\n                    },\r\n                    {\r\n                        \"visibility\": \"on\"\r\n                    }\r\n                ]\r\n            }\r\n        ];\r\n                \r\n        var mapOptions = {\r\n            zoom: 13,\r\n            scrollwheel : false,\r\n            zoomControl: true,\r\n            disableDefaultUI: true,\r\n            center: markerPos,\r\n            labelContent: mapData.siteName,\r\n            mapTypeControlOptions: {\r\n                mapTypeIds: [google.maps.MapTypeId.ROADMAP, MY_MAPTYPE_ID]\r\n            },\r\n            mapTypeId: MY_MAPTYPE_ID\r\n        };// mappOptions\r\n                \r\n        map = new google.maps.Map($block.find('.map')[0], mapOptions);\r\n        \r\n        var styledMapOptions = {\r\n            name: 'Custom Style'\r\n        };//StyledMapOptions\r\n                \r\n        var customMapType = new google.maps.StyledMapType(featureOpts, styledMapOptions);\r\n        \r\n        map.mapTypes.set(MY_MAPTYPE_ID, customMapType);\r\n        \r\n        var infowindow = new google.maps.InfoWindow({\r\n            content: '<a href=\"https://www.google.ca/maps/dir//'+encodeURIComponent(addressData.address)+'\" target=\"_blank\" rel=\"nooponer\">'+mapData.itineraire+'</a>'\r\n        });\r\n                \r\n        var markerMap = new google.maps.Marker({\r\n            position: markerPos,\r\n            map: map,\r\n            title: mapData.siteName\r\n        });// A marker\r\n                \r\n        markerMap.addListener('click', function() {\r\n            infowindow.open(map, markerMap);\r\n        });\r\n    }\r\n\r\n    // Initialize each block on page load (front end).\r\n    $(document).ready(function(){\r\n        $('.google-map').each(function(){\r\n            initializeBlock( $(this) );\r\n        });\r\n    });\r\n\r\n    // Initialize dynamic block preview (editor).\r\n    if( window.acf ) {\r\n        window.acf.addAction( 'render_block_preview/type=googlemap', initializeBlock );\r\n\r\n        window.acf.addAction('google_map_init', function( map, marker, field ){ // Signale lorsque le champ google map est prêt à être modifié.\r\n            field.mapReady = true;\r\n            window.acf.doAction('field_map_ready', field, map);\r\n        });\r\n\r\n        window.acf.addAction('new_field/name=utiliser_ladresse_generale', function(field){\r\n            field.on('change', 'input', function( e ){ // Quand on change le true/false.\r\n                let ACFmap = window.acf.getField(window.acf.findFields({name: 'map', sibling: field.$el})); // Le champ map associé au true/false.\r\n                \r\n                if(ACFmap.mapReady){ // Si le champ de la map est prêt à être manipulé.\r\n                    if(field.$input().prop('checked')){\r\n                        ACFmap.$el.find('input.search').hide(); // on cache la barre de recherche.\r\n                        ACFmap.searchPositionCopy = ACFmap.searchPosition; // Garde en copy la function pour positionner le marker au clic.\r\n                        ACFmap.searchPosition = function(){return false;}; // On désactive la fonction de click pour positionner le marker.\r\n                        ACFmap.map.marker.setDraggable(false); // désactive le drag and drop du marker.\r\n\r\n                        // On va chercher l'adresse générale et on change la valeur de la carte.\r\n                        jQuery.post(window.wp.ajax.settings.url, {action: 'theme_client_get_option_address'}, function(res){\r\n                            JSON.stringify(res);\r\n            \r\n                            ACFmap.val(res);\r\n                        }, 'json');\r\n\r\n                    }else{ // On réactive les options de positionnement du marker.\r\n                        ACFmap.$el.find('input.search').show();\r\n                        ACFmap.searchPosition = ACFmap.searchPositionCopy;\r\n                        ACFmap.map.marker.setDraggable(true);\r\n                    }\r\n\r\n                }else{ // Si la map est pas prête, on attent l'action.\r\n                    window.acf.addAction('field_map_ready', function(mapField, map){\r\n                        if(mapField.cid == ACFmap.cid){\r\n                            field.$input().trigger('change');\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            field.$input().trigger('change');\r\n        });\r\n    }\r\n\r\n})(jQuery);"]}